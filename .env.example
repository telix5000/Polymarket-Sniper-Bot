# ============================================================================
# Polymarket Sniper Bot - Environment Configuration
# ============================================================================

# ----------------------------------------------------------------------------
# Network Configuration
# ----------------------------------------------------------------------------
# Polygon RPC URL (required)
RPC_URL=https://polygon-rpc.com

# Private key for signing transactions (required, no 0x prefix)
PRIVATE_KEY=your_private_key_here

# Public key/address (optional, for validation)
# If provided, must match derived address from PRIVATE_KEY
PUBLIC_KEY=0x0000000000000000000000000000000000000000

# Allow mismatched PUBLIC_KEY (use with caution)
FORCE_MISMATCH=false

# ----------------------------------------------------------------------------
# CLOB Authentication - For Trading on Polymarket Order Book
# ----------------------------------------------------------------------------
# ⚠️  CRITICAL: CLOB credentials are DIFFERENT from Builder credentials!
#
# CLOB credentials (this section):
#   - PURPOSE: Authenticate ALL trading API requests (placing orders, checking balances)
#   - REQUIRED: Yes, for any trading activity
#   - HOW TO GET: Set CLOB_DERIVE_CREDS=true (ONLY option - no web UI exists)
#   - Environment variables: POLYMARKET_API_KEY, POLYMARKET_API_SECRET, POLYMARKET_API_PASSPHRASE
#
# Builder credentials (see section below):
#   - PURPOSE: Order attribution on Builder Leaderboard, optional gasless transactions
#   - REQUIRED: No, only if building apps for OTHER users or want leaderboard tracking
#   - HOW TO GET: https://docs.polymarket.com/developers/builders/builder-profile
#   - Environment variables: POLY_BUILDER_API_KEY, POLY_BUILDER_API_SECRET, POLY_BUILDER_API_PASSPHRASE
#
# ❌ COMMON MISTAKE: Using Builder keys as CLOB keys
#    - Builder keys CANNOT authenticate trading requests
#    - You will get "401 Unauthorized/Invalid api key" errors
#    - See: https://docs.polymarket.com/quickstart/first-order
#
# ✅ FOR PERSONAL AUTO-TRADING: Use derived CLOB credentials (only option)
#
# Mode A: Manual CLOB Credentials (Advanced - NOT RECOMMENDED)
# Only use if you've programmatically created CLOB API keys using L1 authentication
# (There is NO web UI to generate CLOB keys - they must be derived/created via API)
# WARNING: These must match your wallet address from PRIVATE_KEY
# POLYMARKET_API_KEY=your_clob_api_key_here
# POLYMARKET_API_SECRET=your_clob_api_secret_here
# POLYMARKET_API_PASSPHRASE=your_clob_passphrase_here

# Mode B: Derived CLOB Credentials (RECOMMENDED - ONLY PRACTICAL OPTION)
# Set to true to automatically derive/create CLOB API keys from your private key
# This is the official Polymarket recommendation and the ONLY practical way to get CLOB credentials
# Keys are cached in /data/clob-creds.json and reused
CLOB_DERIVE_CREDS=true
# Retry delay after failed API key creation (seconds, default 600)
AUTH_DERIVE_RETRY_SECONDS=600

# Mode C: Magic/Proxy Signatures (signature type 1 or 2)
# For proxy wallets or Gnosis Safe, set signatureType and funderAddress
# POLYMARKET_SIGNATURE_TYPE: 0=EOA (default), 1=POLY_PROXY, 2=POLY_GNOSIS_SAFE
# Note: Also supports legacy env var name CLOB_SIGNATURE_TYPE
POLYMARKET_SIGNATURE_TYPE=0
# POLYMARKET_PROXY_ADDRESS: Required when signatureType=1 or 2
# This is the Polymarket proxy wallet address (maker/funder for orders).
# The signer (PRIVATE_KEY) remains the EOA, but orders use this proxy address.
# Note: Also supports legacy env var name CLOB_FUNDER_ADDRESS
# POLYMARKET_PROXY_ADDRESS=0x0000000000000000000000000000000000000000

# Legacy environment variable names (deprecated but still supported):
# CLOB_SIGNATURE_TYPE: 0=EOA (default), 1=POLY_PROXY, 2=POLY_GNOSIS_SAFE
CLOB_SIGNATURE_TYPE=0
# funderAddress: Required when signatureType=1 or 2
# This is the actual wallet that funds trades (not the proxy)
# CLOB_FUNDER_ADDRESS=0x0000000000000000000000000000000000000000

# Override POLY_ADDRESS header (advanced, normally auto-determined)
# CLOB_POLY_ADDRESS_OVERRIDE=0x0000000000000000000000000000000000000000

# ----------------------------------------------------------------------------
# CLOB Preflight & Diagnostics
# ----------------------------------------------------------------------------
# Enable comprehensive auth mode matrix testing (tests all combinations)
CLOB_PREFLIGHT_MATRIX=false
# Force auth preflight even if creds missing
CLOB_AUTH_FORCE=false
# Signature types to test in matrix (comma-separated)
CLOB_PREFLIGHT_TRY_SIGNATURE_TYPES=0,2
# Secret decoding modes to test
CLOB_PREFLIGHT_TRY_SECRET_DECODE=base64,base64url,raw
# Signature encoding modes to test
CLOB_PREFLIGHT_TRY_SIG_ENCODING=base64url,base64

# ----------------------------------------------------------------------------
# Geographic Eligibility (Geoblock)
# ----------------------------------------------------------------------------
# Polymarket restricts trading from certain countries/regions.
# See: https://docs.polymarket.com/developers/CLOB/geoblock
# Skip geographic eligibility check (not recommended for production)
SKIP_GEOBLOCK_CHECK=false

# ----------------------------------------------------------------------------
# Collateral Token Configuration
# ----------------------------------------------------------------------------
# USDC.e contract address on Polygon (default: official USDC.e)
COLLATERAL_TOKEN_ADDRESS=0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174
COLLATERAL_TOKEN_DECIMALS=6

# Polymarket contract addresses (defaults provided, override if needed)
# CTF (Conditional Token Framework)
POLY_CTF_ADDRESS=0x4d97dcd97ec945f40cf65f87097ace5ea0476045
# CTF Exchange (primary exchange)
POLY_CTF_EXCHANGE_ADDRESS=0x4bFb41d5B3570DeFd03C39a9A4D8dE6Bd8B8982E
# Neg Risk CTF Exchange
POLY_NEG_RISK_CTF_EXCHANGE_ADDRESS=0xC5d563A36AE78145C45a50134d48A1215220f80a
# Neg Risk Adapter
POLY_NEG_RISK_ADAPTER_ADDRESS=0xd91E80cF2E7be2e162c6513ceD06f1dD0dA35296
# CTF ERC1155 address (usually same as CTF_ADDRESS)
# POLY_CTF_ERC1155_ADDRESS=0x4d97dcd97ec945f40cf65f87097ace5ea0476045

# ----------------------------------------------------------------------------
# Approvals Configuration
# ----------------------------------------------------------------------------
# Auto-approve USDC and ERC1155 tokens (true/false/dryrun)
# true = execute approvals, false = detect-only, dryrun = log but don't send
APPROVALS_AUTO=true

# Minimum USDC allowance threshold (USD, default 1000)
APPROVAL_MIN_USDC=1000
# Approve max uint256 instead of minimum (recommended for gas savings)
APPROVAL_MAX_UINT=true
# Force re-approval even if allowance exists
APPROVALS_FORCE=false
# Number of confirmations to wait for approval txs
APPROVALS_CONFIRMATIONS=1
# Max retry attempts for approval transactions
APPROVALS_MAX_RETRY_ATTEMPTS=3

# Gas price bump for approvals (basis points, 0 = use default)
APPROVALS_GAS_BUMP_BPS=0

# ----------------------------------------------------------------------------
# Gas Fee Configuration (EIP-1559 for Polygon)
# ----------------------------------------------------------------------------
# Gas multiplier for all transactions (default 1.2 = 20% increase)
POLY_GAS_MULTIPLIER=1.2

# Minimum priority fee (gwei) - Polygon often requires 25-30 gwei minimum
POLY_MAX_PRIORITY_FEE_GWEI=30

# Minimum max fee (gwei) - Should be >= baseFee*2 + priority
POLY_MAX_FEE_GWEI=60

# ----------------------------------------------------------------------------
# Relayer Configuration (Gasless Transactions via Polymarket Builder)
# ----------------------------------------------------------------------------
# IMPORTANT: Builder credentials are DIFFERENT from CLOB credentials!
# - Builder credentials: For gasless relayer transactions (optional)
# - CLOB credentials: For placing orders (required, see above)
#
# These credentials are ONLY needed for gasless approval transactions.
# If you don't provide them, approvals will use on-chain transactions with gas.
#
# Enable relayer for approvals (default true if credentials provided)
USE_RELAYER_FOR_APPROVALS=true

# Polymarket Builder API credentials (for gasless approvals)
# Get these from: https://docs.polymarket.com/developers/builders/builder-profile
# WARNING: These are NOT CLOB credentials - do not confuse them!
# POLY_BUILDER_API_KEY=your_builder_key
# POLY_BUILDER_API_SECRET=your_builder_secret
# POLY_BUILDER_API_PASSPHRASE=your_builder_passphrase

# Remote signer URL (alternative to builder credentials)
# SIGNER_URL=https://your-signer-url.com
# SIGNER_AUTH_TOKEN=your_signer_token

# Relayer configuration
RELAYER_URL=https://relayer-v2.polymarket.com/
# Relayer transaction type: PROXY or SAFE (default SAFE)
RELAYER_TX_TYPE=SAFE

# ----------------------------------------------------------------------------
# Trading Configuration
# ----------------------------------------------------------------------------
# Enable live trading (must be exactly this value)
ARB_LIVE_TRADING=I_UNDERSTAND_THE_RISKS

# Minimum trade size (USD)
MIN_TRADE_SIZE_USD=100
MIN_ORDER_USD=10

# Trade execution parameters
TRADE_MULTIPLIER=1.0
FRONTRUN_SIZE_MULTIPLIER=0.5

# Rate limiting
ORDER_SUBMIT_MIN_INTERVAL_MS=60000
ORDER_SUBMIT_MAX_PER_HOUR=10
ORDER_SUBMIT_MARKET_COOLDOWN_SECONDS=600

# ----------------------------------------------------------------------------
# Logging & Monitoring
# ----------------------------------------------------------------------------
# Log level (debug, info, warn, error)
LOG_LEVEL=info

# ----------------------------------------------------------------------------
# Data Persistence
# ----------------------------------------------------------------------------
# MongoDB connection string (optional, for trade history)
# MONGODB_URI=mongodb://localhost:27017/polymarket-bot

# ----------------------------------------------------------------------------
# Advanced Configuration
# ----------------------------------------------------------------------------
# Activity check window (seconds)
ACTIVITY_CHECK_WINDOW_SECONDS=60

# Aggregation window for trade data (seconds)
AGGREGATION_WINDOW_SECONDS=300

# Retry limit for failed operations
RETRY_LIMIT=3

# Minimum POL balance for gas (native token)
MIN_POL_BALANCE=0.05

# Cooldown periods (seconds)
CLOUDFLARE_COOLDOWN_SECONDS=3600
CLOB_AUTH_COOLDOWN_SECONDS=300

# ============================================================================
# Key Concepts & Rules
# ============================================================================
#
# AUTHENTICATION MODES:
# - Mode A (Explicit): Provide POLYMARKET_API_KEY/SECRET/PASSPHRASE manually
# - Mode B (Derived): Set CLOB_DERIVE_CREDS=true to auto-create from private key
# - Mode C (Proxy): Set POLYMARKET_SIGNATURE_TYPE=1/2 with POLYMARKET_PROXY_ADDRESS
#                   (or legacy: CLOB_SIGNATURE_TYPE with CLOB_FUNDER_ADDRESS)
#
# POLY_ADDRESS RESOLUTION:
# - signatureType=0 (EOA): Uses derived signer address from PRIVATE_KEY
# - signatureType=1,2 (Proxy/Safe): Uses POLYMARKET_PROXY_ADDRESS (or CLOB_FUNDER_ADDRESS) as POLY_ADDRESS
# - Override: Set CLOB_POLY_ADDRESS_OVERRIDE to force specific address
#
# BROWSER WALLET MODE (signatureType=2):
# - Set POLYMARKET_SIGNATURE_TYPE=2 (for Gnosis Safe / browser wallets)
# - Set POLYMARKET_PROXY_ADDRESS to your Polymarket proxy wallet address
# - Signer (PRIVATE_KEY) remains your EOA for signing transactions
# - Maker/funder for orders becomes the proxy address
# - This is required for browser wallet authentication with Polymarket CLOB
#
# APPROVALS REQUIRED:
# Bot must have these approvals before trading:
# 1. USDC.e allowance to CTF (0x4d97dcd97ec945f40cf65f87097ace5ea0476045)
# 2. USDC.e allowance to CTF Exchange (0x4bFb41d5B3570DeFd03C39a9A4D8dE6Bd8B8982E)
# 3. USDC.e allowance to Neg Risk Exchange (0xC5d563A36AE78145C45a50134d48A1215220f80a)
# 4. ERC1155 setApprovalForAll to CTF Exchange
# 5. ERC1155 setApprovalForAll to Neg Risk Exchange
#
# GAS FEE STRATEGY:
# - Uses EIP-1559 (maxPriorityFeePerGas + maxFeePerGas)
# - Enforces minimums: priority >= 30 gwei, maxFee >= 60 gwei
# - Formula: maxFee = max(baseFee*2 + priority, configured_min)
# - Adjust POLY_MAX_PRIORITY_FEE_GWEI if RPC rejects with "below minimum"
#
# RELAYER (OPTIONAL):
# - Provides gasless approvals via Polymarket Builder
# - Requires POLY_BUILDER_API_KEY or SIGNER_URL
# - Falls back to direct RPC if disabled or unavailable
# - Does NOT block trading if unavailable
#
# ============================================================================
# COMMON MISTAKE: Confusing Builder and CLOB credentials
# ============================================================================
#
# Builder credentials (POLY_BUILDER_*):
#   - Used for gasless relayer transactions (optional)
#   - Obtained from: https://docs.polymarket.com/developers/builders/builder-profile
#   - NOT required for basic trading
#
# CLOB credentials (POLYMARKET_API_*):
#   - Used for placing and managing orders on the order book (required)
#   - Best approach: Set CLOB_DERIVE_CREDS=true to auto-derive from PRIVATE_KEY
#   - Alternative: Create manually using @polymarket/clob-client library
#
# If you're getting 401 "Unauthorized/Invalid api key" errors:
#   1. Make sure you're not using Builder keys as CLOB keys
#   2. Try setting CLOB_DERIVE_CREDS=true and removing POLYMARKET_API_* variables
#   3. Ensure your wallet has interacted with Polymarket at least once
#
# ============================================================================
