version: "3.9"

# ============================================================================
# MINIMAL DOCKER COMPOSE CONFIGURATION
# ============================================================================
# Following pmxt methodology: https://github.com/pmxt-dev/pmxt/blob/main/core/docs/SETUP_POLYMARKET.md
# The most you need is a private key - everything else has sensible defaults!
#
# Required environment variables (set in your shell or .env file):
#   - PRIVATE_KEY: Your Polygon wallet private key
#   - RPC_URL: Polygon RPC endpoint
#   - TARGET_ADDRESSES: Comma-separated addresses to monitor
#
# Everything else is optional and has smart defaults:
#   - CLOB credentials are auto-derived from PRIVATE_KEY
#   - Signature type defaults to 0 (EOA)
#   - USDC address defaults to official Polygon USDC.e
# ============================================================================

services:
  polymarket-copy-bot:
    build: .
    restart: unless-stopped
    privileged: true # Required when WireGuard is enabled
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      # ======== REQUIRED ========
      - PRIVATE_KEY=${PRIVATE_KEY}
      - RPC_URL=${RPC_URL}
      - TARGET_ADDRESSES=${TARGET_ADDRESSES}

      # ======== OPTIONAL - All have sensible defaults ========
      # Use V2 (new simple) system instead of V1 (legacy)
      # Set USE_V2=true to enable V2 (default: false = V1)
      - USE_V2=${USE_V2:-false}

      # Mode: arb, mempool, or both
      - MODE=arb

      # Trading control (uncomment to enable live trading)
      # - ARB_LIVE_TRADING=I_UNDERSTAND_THE_RISKS
      - ARB_DRY_RUN=true

      # ======== DEBUG/TEST OPTIONS ========
      # TEST_SELL_RED_POSITION: Set to true to test sell flow at startup
      # Finds a position slightly in the red and sells it with debug logging
      # Use to verify sells work, then DELETE or set to false
      - TEST_SELL_RED_POSITION=${TEST_SELL_RED_POSITION:-false}

      # Optional: Builder credentials for gasless approvals
      # - POLY_BUILDER_API_KEY=${POLY_BUILDER_API_KEY}
      # - POLY_BUILDER_API_SECRET=${POLY_BUILDER_API_SECRET}
      # - POLY_BUILDER_API_PASSPHRASE=${POLY_BUILDER_API_PASSPHRASE}
    tmpfs:
      - /data:size=32m,mode=0700

  # Optional: Remote signer for builder credentials (gasless approvals)
  # signer:
  #   build: ./signer
  #   restart: unless-stopped
  #   environment:
  #     - PORT=8080
  #     - POLY_BUILDER_API_KEY=${POLY_BUILDER_API_KEY}
  #     - POLY_BUILDER_API_SECRET=${POLY_BUILDER_API_SECRET}
  #     - POLY_BUILDER_API_PASSPHRASE=${POLY_BUILDER_API_PASSPHRASE}
