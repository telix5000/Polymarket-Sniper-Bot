```
                    POLYMARKET SNIPER BOT - TRADE EXECUTION FLOW
                           (Why No Trades Are Being Copied)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 1: ON-CHAIN WHALE DETECTION                                          â”‚
â”‚  File: src/lib/onchain-monitor.ts:515-758                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   Infura WebSocket â†’ OrderFilled Event â†’ handleOrderFilled()                â”‚
â”‚                                                                              â”‚
â”‚   âœ“ Connected to CTF Exchange: 0x4bFb41d5B3570DeFd03C39a9A4D8dE6Bd8B8982E   â”‚
â”‚   âœ“ Connected to NEG_RISK Exchange: 0xC5d563A36AE78145C45a50134d48A1215220f80aâ”‚
â”‚   âœ“ Tracking 100 whale wallets                                              â”‚
â”‚                                                                              â”‚
â”‚   CHECK 1: Is maker OR taker in whale set?                                  â”‚
â”‚            â””â”€ If NO â†’ Skip event                                            â”‚
â”‚                                                                              â”‚
â”‚   CHECK 2: Is trade >= WHALE_TRADE_USD?                         â”‚
â”‚            â””â”€ Current: $500 (default)                                       â”‚
â”‚            â””â”€ User wants: $100                                              â”‚
â”‚            â””â”€ If trade < $500 â†’ Skip event âŒ BLOCKING ISSUE #1             â”‚
â”‚                                                                              â”‚
â”‚   Expected Log: âš¡ On-chain â†’ Bias | Block #... | $... BUY                  â”‚
â”‚   Current State: âŒ NOT APPEARING (no trades above $500 detected)           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 2: BIAS ACCUMULATION                                                 â”‚
â”‚  File: src/start.ts:2681-2713 (onWhaleTrade callback)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   Callback receives: { tokenId, side, sizeUsd, maker, taker, timestamp }    â”‚
â”‚                                                                              â”‚
â”‚   CHECK 3: Is side === "BUY"?                                               â”‚
â”‚            â””â”€ Only copy whale BUYS (not sells)                              â”‚
â”‚            â””â”€ If SELL â†’ Skip                                                â”‚
â”‚                                                                              â”‚
â”‚   CHECK 4: Is maker or taker in current whale set?                          â”‚
â”‚            â””â”€ Defensive check for leaderboard refresh timing                â”‚
â”‚            â””â”€ If neither â†’ Skip                                             â”‚
â”‚                                                                              â”‚
â”‚   biasAccumulator.recordTrade(trade)                                        â”‚
â”‚   â””â”€ Stores trade in memory for tokenId                                     â”‚
â”‚   â””â”€ Deduplicates with API data                                             â”‚
â”‚                                                                              â”‚
â”‚   Expected Log: âš¡ On-chain â†’ Bias | Block #... | $... BUY | PRIORITY       â”‚
â”‚   Current State: âŒ NOT REACHED (Phase 1 blocking)                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 3: BIAS DIRECTION CALCULATION                                        â”‚
â”‚  File: src/start.ts:922-964 (getBias method)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   Called when: getActiveBiases() or canEnter() checks direction             â”‚
â”‚                                                                              â”‚
â”‚   1. Get all trades for tokenId in last 1 hour (biasWindowSeconds=3600)     â”‚
â”‚   2. Sum sizeUsd (all trades are BUY, so netUsd = total buy volume)         â”‚
â”‚   3. Count trades                                                            â”‚
â”‚                                                                              â”‚
â”‚   MODE A: copyAnyWhaleBuy = true (AGGRESSIVE)                               â”‚
â”‚           â””â”€ If tradeCount >= 1 â†’ direction = "LONG" âœ…                     â”‚
â”‚           â””â”€ Copies FIRST whale buy immediately                             â”‚
â”‚                                                                              â”‚
â”‚   MODE B: copyAnyWhaleBuy = false (CONSERVATIVE) âŒ BLOCKING ISSUE #2      â”‚
â”‚           â””â”€ Requires: tradeCount >= 3 AND netUsd >= $300                   â”‚
â”‚           â””â”€ Current config: biasMinTrades=3, biasMinNetUsd=300             â”‚
â”‚           â””â”€ If not met â†’ direction = "NONE"                                â”‚
â”‚           â””â”€ Takes 30-60 minutes to accumulate                              â”‚
â”‚                                                                              â”‚
â”‚   Expected Log (on change): ğŸ“Š Bias | ... | NONE â†’ LONG | $... flow        â”‚
â”‚   Current State: âŒ NOT REACHED (no trades accumulated)                     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 4: ACTIVE BIAS DETECTION                                             â”‚
â”‚  File: src/start.ts:969-980 (getActiveBiases)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   Every cycle (200ms): main loop calls getActiveBiases()                    â”‚
â”‚                                                                              â”‚
â”‚   For each tokenId with trades:                                             â”‚
â”‚     bias = getBias(tokenId)                                                 â”‚
â”‚     if bias.direction !== "NONE":                                           â”‚
â”‚       add to activeBiases[]                                                 â”‚
â”‚                                                                              â”‚
â”‚   Returns: TokenBias[] with LONG or SHORT signals                           â”‚
â”‚                                                                              â”‚
â”‚   Current State: âŒ Returns empty array (no LONG signals)                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 5: ENTRY EVALUATION                                                  â”‚
â”‚  File: src/start.ts:2986-3011 (main cycle)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   if (activeBiases.length > 0):                                             â”‚
â”‚     for each bias (max 3 parallel):                                         â”‚
â”‚       marketData = fetchTokenMarketData(tokenId)                            â”‚
â”‚       executionEngine.processEntry(tokenId, marketData, balance)            â”‚
â”‚                                                                              â”‚
â”‚   processEntry() â†’ evaluateEntry() checks:                                  â”‚
â”‚     âœ“ Bias is LONG or SHORT (not NONE)                                      â”‚
â”‚     âœ“ Liquidity gates (spread < 6Â¢, depth > $25)                           â”‚
â”‚     âœ“ Price deviation from reference (>12Â¢ move)                            â”‚
â”‚     âœ“ Entry price bounds (30Â¢ - 82Â¢)                                        â”‚
â”‚     âœ“ Risk limits (max positions, max exposure)                             â”‚
â”‚     âœ“ EV allows trading (profit factor > 1.25)                              â”‚
â”‚                                                                              â”‚
â”‚   If ALL pass â†’ executeEntry()                                              â”‚
â”‚                                                                              â”‚
â”‚   Current State: âŒ NOT REACHED (no active biases)                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 6: ORDER EXECUTION                                                   â”‚
â”‚  File: src/start.ts:2122-2184 (executeEntry)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   CHECK 5: Is LIVE_TRADING=I_UNDERSTAND_THE_RISKS? âŒ BLOCKING ISSUE #3    â”‚
â”‚            â””â”€ If NO â†’ Simulation mode                                       â”‚
â”‚            â””â”€ Log: ğŸ² [SIM] LONG $5.00 @ 45.0Â¢                             â”‚
â”‚            â””â”€ No actual order placed                                        â”‚
â”‚                                                                              â”‚
â”‚   CHECK 6: Is client connected?                                             â”‚
â”‚            â””â”€ If NO â†’ return "NO_CLIENT"                                    â”‚
â”‚                                                                              â”‚
â”‚   1. Fetch orderbook for tokenId                                            â”‚
â”‚   2. Get best ask (for LONG) or best bid (for SHORT)                        â”‚
â”‚   3. Calculate shares = sizeUsd / price                                     â”‚
â”‚   4. Create market order (FOK or GTC based on config)                       â”‚
â”‚   5. Post order to CLOB                                                     â”‚
â”‚                                                                              â”‚
â”‚   Expected Logs:                                                            â”‚
â”‚     Success: ğŸ“¥ LONG $5.00 @ 45.0Â¢                                          â”‚
â”‚     Failure: âŒ ORDER_REJECTED or error message                             â”‚
â”‚                                                                              â”‚
â”‚   Current State: âŒ NOT REACHED (blocked at Phase 1-3)                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              ROOT CAUSE ANALYSIS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BLOCKING ISSUE #1: Whale Trade Threshold Too High
  Location:      src/lib/onchain-monitor.ts:921
  Current:       WHALE_TRADE_USD defaults to $500
  User wants:    $100
  Impact:        Whale trades exist but below $500 â†’ not detected
  Fix:           Set WHALE_TRADE_USD=100 in .env
  Evidence:      No "âš¡ On-chain â†’ Bias" logs appearing

BLOCKING ISSUE #2: Conservative Mode Too Strict
  Location:      src/start.ts:282, 256-258
  Current:       copyAnyWhaleBuy=false (requires 3 trades + $300 flow)
  User wants:    Immediate copy (like reference repo)
  Impact:        Even if whale trades detected, takes 30-60 min to form signal
  Fix:           Set COPY_ANY_WHALE_BUY=true in .env
  Evidence:      No "ğŸ“Š Bias | NONE â†’ LONG" logs appearing

BLOCKING ISSUE #3: Live Trading Possibly Disabled
  Location:      src/start.ts:2134-2144
  Current:       Unknown (not shown in user logs)
  Impact:        Orders simulated but not actually placed
  Fix:           Set LIVE_TRADING=I_UNDERSTAND_THE_RISKS in .env
  Evidence:      No confirmation either way from logs provided


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              SOLUTION SUMMARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Add to .env file:

    COPY_ANY_WHALE_BUY=true
    WHALE_TRADE_USD=100
    LIVE_TRADING=I_UNDERSTAND_THE_RISKS
    MAX_TRADE_USD=5
    ORDER_TYPE=GTC

Expected behavior after fix:
  1. Within 5-15 minutes: "âš¡ On-chain â†’ Bias | Block #... | $... BUY"
  2. Immediately after: "ğŸ“Š Bias | ... | NONE â†’ LONG | $... flow"
  3. Within 200-600ms: Entry evaluation and execution
  4. Success: "ğŸ“¥ LONG $5.00 @ 45.0Â¢" or failure reason


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            VALIDATION PROCEDURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Run diagnostic:
    ./scripts/diagnose-no-trades.sh

Start bot:
    npm run start

Monitor logs for these markers:
    âœ“ "âš¡ On-chain â†’ Bias"     = Whale trade detected (Phase 1-2 working)
    âœ“ "ğŸ“Š Bias | NONE â†’ LONG"  = Bias formed (Phase 3 working)  
    âœ“ "ğŸ“¥ LONG $..."            = Order executed (Phase 6 working)
    âœ— No logs after 15 min     = Whales not active in tracked markets

If still no trades after 30 minutes:
    - Whales may not be actively trading
    - Try different time of day (US market hours more active)
    - Verify RPC_URL is WebSocket: wss://polygon-mainnet.infura.io/ws/v3/...
```
